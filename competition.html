<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ğŸ† Ù…Ø³Ø§Ø¨Ù‚Ø© Ø§Ù„Ø£Ø·ÙØ§Ù„ Ø§Ù„ÙƒØ¨Ø±Ù‰</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Tajawal', sans-serif;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow-x: hidden;
            padding: clamp(10px, 3vw, 20px);
        }

        .screen {
            display: none;
            width: 100%;
            max-width: 700px;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(20px);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: clamp(20px, 4vw, 30px);
            padding: clamp(20px, 5vw, 40px);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: slideIn 0.5s ease-out;
            max-height: 90vh;
            overflow-y: auto;
        }

        .screen.active {
            display: block;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(30px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† */
        .registration-screen {
            text-align: center;
        }

        .competition-logo {
            font-size: clamp(3rem, 12vw, 5rem);
            margin-bottom: clamp(15px, 3vw, 20px);
            animation: bounce 2s infinite;
        }

        @keyframes bounce {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-15px);
            }
        }

        h1 {
            color: white;
            font-size: clamp(1.8rem, 6vw, 2.5rem);
            font-weight: 900;
            margin-bottom: 10px;
            text-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }

        .subtitle {
            color: rgba(255, 255, 255, 0.9);
            font-size: clamp(1rem, 3.5vw, 1.2rem);
            margin-bottom: clamp(25px, 5vw, 40px);
        }

        .players-container {
            margin-bottom: clamp(20px, 4vw, 30px);
        }

        .player-input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            align-items: center;
        }

        .player-emoji-label {
            font-size: clamp(2rem, 6vw, 2.5rem);
            min-width: clamp(40px, 10vw, 50px);
        }

        .player-input {
            flex: 1;
            padding: clamp(12px, 3vw, 15px);
            font-size: clamp(1rem, 3.5vw, 1.1rem);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 15px;
            background: rgba(255, 255, 255, 0.9);
            font-family: 'Tajawal', sans-serif;
            outline: none;
            transition: border-color 0.3s ease;
        }

        .player-input:focus {
            border-color: #667eea;
        }

        .remove-player-btn {
            padding: clamp(10px, 2.5vw, 12px);
            background: #ff5252;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: clamp(1.2rem, 4vw, 1.5rem);
            min-width: 48px;
            min-height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .add-player-btn,
        .start-competition-btn,
        .next-stage-btn {
            width: 100%;
            padding: clamp(15px, 4vw, 20px);
            font-size: clamp(1.2rem, 4vw, 1.5rem);
            font-weight: 900;
            font-family: 'Tajawal', sans-serif;
            background: linear-gradient(135deg, #43e97b, #38f9d7);
            color: white;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            margin-top: 15px;
            box-shadow: 0 10px 30px rgba(67, 233, 123, 0.4);
            transition: transform 0.2s ease;
            min-height: 54px;
        }

        .add-player-btn:active,
        .start-competition-btn:active,
        .next-stage-btn:active {
            transform: scale(0.95);
        }

        .error-message {
            color: #ff5252;
            background: rgba(255, 82, 82, 0.1);
            padding: clamp(10px, 2.5vw, 15px);
            border-radius: 10px;
            margin-top: 15px;
            font-weight: 700;
            font-size: clamp(0.95rem, 3vw, 1.05rem);
            display: none;
        }

        .error-message.show {
            display: block;
        }

        /* Ø´Ø§Ø´Ø© Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨ÙŠÙ† Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† */
        .transition-screen {
            text-align: center;
        }

        .transition-emoji {
            font-size: clamp(5rem, 15vw, 8rem);
            animation: rotate 2s ease-in-out;
        }

        @keyframes rotate {
            0% {
                transform: rotate(0deg) scale(0.5);
                opacity: 0;
            }

            50% {
                transform: rotate(180deg) scale(1.2);
            }

            100% {
                transform: rotate(360deg) scale(1);
                opacity: 1;
            }
        }

        .transition-message {
            color: white;
            font-size: clamp(1.5rem, 5vw, 2rem);
            font-weight: 900;
            margin: clamp(20px, 4vw, 30px) 0;
            text-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }

        .transition-score {
            background: rgba(255, 255, 255, 0.2);
            padding: clamp(15px, 3vw, 20px);
            border-radius: 15px;
            margin: clamp(15px, 3vw, 20px) 0;
        }

        .transition-score-label {
            color: rgba(255, 255, 255, 0.9);
            font-size: clamp(1rem, 3.5vw, 1.2rem);
            margin-bottom: 10px;
        }

        .transition-score-value {
            color: #ffd700;
            font-size: clamp(2rem, 6vw, 3rem);
            font-weight: 900;
        }

        .transition-next {
            color: rgba(255, 255, 255, 0.9);
            font-size: clamp(1.2rem, 4vw, 1.5rem);
            margin: clamp(20px, 4vw, 30px) 0;
        }

        .continue-btn {
            width: 100%;
            padding: clamp(18px, 4.5vw, 25px);
            font-size: clamp(1.5rem, 5vw, 2rem);
            font-weight: 900;
            font-family: 'Tajawal', sans-serif;
            background: linear-gradient(135deg, #ff6b9d, #ffa726);
            color: white;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            box-shadow: 0 15px 40px rgba(255, 107, 157, 0.5);
            animation: pulse 1.5s infinite;
            min-height: 60px;
        }

        @keyframes pulse {

            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.05);
            }
        }

        .continue-btn:active {
            transform: scale(0.95);
            animation: none;
        }

        /* Ø´Ø§Ø´Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø© */
        .quiz-screen {
            text-align: center;
        }

        .player-turn-info {
            background: rgba(255, 255, 255, 0.2);
            borderradius: 20px;
            padding: clamp(15px, 3vw, 20px);
            margin-bottom: clamp(20px, 4vw, 30px);
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 10px;
        }

        .current-player-info {
            display: flex;
            align-items: center;
            gap: clamp(10px, 2.5vw, 15px);
        }

        .current-player-emoji {
            font-size: clamp(2.5rem, 7vw, 3.5rem);
        }

        .current-player-name {
            color: white;
            font-size: clamp(1.3rem, 4vw, 1.8rem);
            font-weight: 900;
        }

        .current-player-score {
            background: rgba(67, 233, 123, 0.2);
            padding: clamp(8px, 2vw, 10px) clamp(15px, 3vw, 20px);
            border-radius: 12px;
            color: #43e97b;
            font-size: clamp(1.1rem, 3.5vw, 1.4rem);
            font-weight: 800;
        }

        .question-card {
            background: white;
            border-radius: 25px;
            padding: clamp(25px, 5vw, 35px);
            margin-bottom: clamp(20px, 4vw, 30px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
        }

        .question-emoji {
            font-size: clamp(4rem, 12vw, 6rem);
            margin-bottom: clamp(15px, 3vw, 20px);
            animation: bounce 2s infinite;
        }

        .question-text {
            color: #2d3436;
            font-size: clamp(1.2rem, 4vw, 1.6rem);
            font-weight: 700;
            margin-bottom: clamp(15px, 3vw, 20px);
            line-height: 1.5;
        }

        .question-number {
            color: #667eea;
            font-size: clamp(0.95rem, 3vw, 1.1rem);
            font-weight: 700;
        }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: clamp(10px, 2.5vw, 15px);
        }

        @media (min-width: 500px) {
            .options-grid {
                grid-template-columns: 1fr 1fr;
            }
        }

        .option-btn {
            padding: clamp(15px, 3.5vw, 20px);
            font-size: clamp(1rem, 3.5vw, 1.2rem);
            font-weight: 700;
            font-family: 'Tajawal', sans-serif;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            box-shadow: 0 8px 20px rgba(245, 87, 108, 0.3);
            transition: all 0.2s ease;
            min-height: 54px;
            text-align: center;
        }

        .option-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 30px rgba(245, 87, 108, 0.4);
        }

        .option-btn:active {
            transform: scale(0.95);
        }

        .option-btn.correct {
            background: linear-gradient(135deg, #43e97b, #38f9d7);
            animation: correctPulse 0.5s ease;
        }

        .option-btn.wrong {
            background: linear-gradient(135deg, #ff5252, #ff1744);
            animation: wrongShake 0.5s ease;
        }

        @keyframes correctPulse {

            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.1);
            }
        }

        @keyframes wrongShake {

            0%,
            100% {
                transform: translateX(0);
            }

            25% {
                transform: translateX(-10px);
            }

            75% {
                transform: translateX(10px);
            }
        }

        /* Ø´Ø§Ø´Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬ */
        .stage-header {
            text-align: center;
            margin-bottom: clamp(25px, 5vw, 35px);
        }

        .stage-title {
            color: white;
            font-size: clamp(1.8rem, 6vw, 2.5rem);
            font-weight: 900;
            margin-bottom: 10px;
        }

        .stage-subtitle {
            color: rgba(255, 255, 255, 0.9);
            font-size: clamp(1.1rem, 3.5vw, 1.3rem);
        }

        .scoreboard {
            background: white;
            border-radius: 20px;
            padding: clamp(20px, 4vw, 30px);
            margin-bottom: clamp(20px, 4vw, 30px);
        }

        .scoreboard h2 {
            color: #667eea;
            font-size: clamp(1.4rem, 4.5vw, 1.8rem);
            margin-bottom: clamp(15px, 3vw, 20px);
            text-align: center;
        }

        .player-score-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: clamp(12px, 3vw, 15px);
            margin-bottom: clamp(10px, 2.5vw, 12px);
            background: #f8f9fa;
            border-radius: 12px;
        }

        .player-info-left {
            display: flex;
            align-items: center;
            gap: clamp(10px, 2.5vw, 15px);
        }

        .player-info-left .emoji {
            font-size: clamp(1.8rem, 5vw, 2.5rem);
        }

        .player-info-left .name {
            font-size: clamp(1.1rem, 3.5vw, 1.3rem);
            font-weight: 700;
            color: #2d3436;
        }

        .player-score-item .score {
            font-size: clamp(1.2rem, 4vw, 1.5rem);
            font-weight: 900;
            color: #667eea;
        }

        .home-link {
            display: block;
            text-align: center;
            color: rgba(255, 255, 255, 0.9);
            text-decoration: none;
            margin-top: 20px;
            font-size: clamp(1rem, 3.5vw, 1.2rem);
            padding: clamp(10px, 2.5vw, 15px);
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            transition: background 0.2s ease;
        }

        .home-link:hover {
            background: rgba(255, 255, 255, 0.2);
        }
    </style>
</head>

<body>
    <!-- Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† -->
    <div class="screen active registration-screen" id="registrationScreen">
        <div class="competition-logo">ğŸ†</div>
        <h1>Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© Ø§Ù„ÙƒØ¨Ø±Ù‰</h1>
        <p class="subtitle">Ù…Ø³Ø§Ø¨Ù‚Ø© ØªØ­Ø¯ÙŠ Ø§Ù„Ø°ÙƒØ§Ø¡ ÙˆØ§Ù„Ù…Ù‡Ø§Ø±Ø© Ù„Ù„Ø£Ø·ÙØ§Ù„</p>

        <div class="players-container" id="playersContainer">
            <div class="player-input-group">
                <span class="player-emoji-label">ğŸ‘¦</span>
                <input type="text" class="player-input" placeholder="Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„Ø£ÙˆÙ„" maxlength="20">
            </div>
            <div class="player-input-group">
                <span class="player-emoji-label">ğŸ‘§</span>
                <input type="text" class="player-input" placeholder="Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„Ø«Ø§Ù†ÙŠ" maxlength="20">
            </div>
        </div>

        <button class="add-player-btn" id="addPlayerBtn" onclick="addPlayer()">â• Ø¥Ø¶Ø§ÙØ© Ù„Ø§Ø¹Ø¨</button>
        <button class="start-competition-btn" onclick="startCompetition()">ğŸš€ Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© Ø§Ù„Ø¢Ù†!</button>

        <div class="error-message" id="errorMessage"></div>

        <a href="index.html" class="home-link">ğŸ  Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
    </div>

    <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨ÙŠÙ† Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† -->
    <div class="screen transition-screen" id="transitionScreen">
        <div class="transition-emoji" id="transitionEmoji">ğŸ‘¦</div>
        <h2 class="transition-message" id="transitionMessage">Ø§Ù†ØªÙ‡Ù‰ Ø¯ÙˆØ± Ù…Ø­Ù…Ø¯!</h2>

        <div class="transition-score">
            <div class="transition-score-label">Ù†Ù‚Ø§Ø· Ù‡Ø°Ù‡ Ø§Ù„Ø¬ÙˆÙ„Ø©</div>
            <div class="transition-score-value" id="transitionScore">50 Ù†Ù‚Ø·Ø©</div>
        </div>

        <p class="transition-next" id="transitionNext">Ø§Ù„Ø¢Ù† Ø¯ÙˆØ± ÙØ§Ø·Ù…Ø© ğŸ‘§</p>

        <button class="continue-btn" onclick="continueToNextPlayer()">â­ï¸ Ù…ØªØ§Ø¨Ø¹Ø©</button>
    </div>

    <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø© -->
    <div class="screen quiz-screen" id="quizScreen">
        <div class="player-turn-info">
            <div class="current-player-info">
                <span class="current-player-emoji" id="currentPlayerEmoji">ğŸ‘¦</span>
                <span class="current-player-name" id="currentPlayerName">Ù…Ø­Ù…Ø¯</span>
            </div>
            <div class="current-player-score">
                <span id="currentPlayerPoints">0</span> Ù†Ù‚Ø·Ø©
            </div>
        </div>

        <div class="question-card">
            <div class="question-emoji" id="questionEmoji">â“</div>
            <p class="question-text" id="questionText">Ù…Ø§ Ù‡Ùˆ Ù„ÙˆÙ† Ø§Ù„Ø³Ù…Ø§Ø¡ØŸ</p>
            <p class="question-number">Ø§Ù„Ø³Ø¤Ø§Ù„ <span id="questionNum">1</span> Ù…Ù† <span id="totalQuestions">5</span></p>
        </div>

        <div class="options-grid" id="optionsContainer">
            <!-- Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ù‡Ù†Ø§ -->
        </div>
    </div>

    <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…Ø¤Ù‚ØªØ© -->
    <div class="screen" id="scoreboardScreen">
        <div class="stage-header">
            <h1 class="stage-title">ğŸ“Š Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰</h1>
            <p class="stage-subtitle">Ø£Ø­Ø³Ù†ØªÙ… Ø¬Ù…ÙŠØ¹Ø§Ù‹!</p>
        </div>

        <div class="scoreboard">
            <h2>ğŸ… Ù„ÙˆØ­Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬</h2>
            <div id="scoreboardList">
                <!-- Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ù‡Ù†Ø§ -->
            </div>
        </div>

        <button class="next-stage-btn" onclick="goToStage2()">
            ğŸ¯ Ø§Ù†ØªÙ‚Ù„ Ù„Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©: ØµÙŠØ¯ Ø§Ù„Ø±Ù…ÙˆØ²
        </button>
    </div>

    <script>
        // â”€â”€ Audio Engine â”€â”€ (Ù…Ù† hunter.html)
        var AudioEngine = (function () {
            var ctx = null;
            function getCtx() {
                if (!ctx) ctx = new (window.AudioContext || window.webkitAudioContext)();
                if (ctx.state === 'suspended') ctx.resume();
                return ctx;
            }
            function playTone(freq, dur, type, vol, ramp) {
                try {
                    var c = getCtx();
                    var osc = c.createOscillator();
                    var gain = c.createGain();
                    osc.type = type || 'sine';
                    osc.frequency.setValueAtTime(freq, c.currentTime);
                    if (ramp) osc.frequency.linearRampToValueAtTime(ramp, c.currentTime + dur);
                    gain.gain.setValueAtTime(vol || 0.3, c.currentTime);
                    gain.gain.exponentialRampToValueAtTime(0.001, c.currentTime + dur);
                    osc.connect(gain); gain.connect(c.destination);
                    osc.start(c.currentTime); osc.stop(c.currentTime + dur);
                } catch (e) { /* silent */ }
            }
            function playNoise(dur, vol) {
                try {
                    var c = getCtx();
                    var sz = c.sampleRate * dur;
                    var buf = c.createBuffer(1, sz, c.sampleRate);
                    var d = buf.getChannelData(0);
                    for (var i = 0; i < sz; i++) d[i] = (Math.random() * 2 - 1) * 0.5;
                    var src = c.createBufferSource(); src.buffer = buf;
                    var gain = c.createGain();
                    gain.gain.setValueAtTime(vol || 0.15, c.currentTime);
                    gain.gain.exponentialRampToValueAtTime(0.001, c.currentTime + dur);
                    var flt = c.createBiquadFilter(); flt.type = 'highpass';
                    flt.frequency.setValueAtTime(3000, c.currentTime);
                    src.connect(flt); flt.connect(gain); gain.connect(c.destination); src.start();
                } catch (e) { /* silent */ }
            }
            return {
                correct: function () {
                    playTone(523, 0.12, 'sine', 0.25);
                    setTimeout(function () { playTone(659, 0.12, 'sine', 0.25); }, 80);
                    setTimeout(function () { playTone(784, 0.18, 'sine', 0.3); }, 160);
                },
                wrong: function () {
                    playTone(200, 0.25, 'sawtooth', 0.15);
                    playNoise(0.12, 0.1);
                },
                click: function () { playTone(880, 0.1, 'sine', 0.2); },
                transition: function () {
                    playTone(523, 0.15, 'triangle', 0.25);
                    setTimeout(function () { playTone(659, 0.15, 'triangle', 0.25); }, 120);
                }
            };
        })();

        // Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©
        const playerEmojis = ['ğŸ‘¦', 'ğŸ‘§', 'ğŸ§’', 'ğŸ‘¶'];
        let playerCount = 2;
        const MIN_PLAYERS = 2;
        const MAX_PLAYERS = 4;

        // Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©
        let players = [];
        let currentStage = 0;
        let currentPlayerIndex = 0;
        let currentQuestionIndex = 0;
        let questionsPerPlayer = 5;

        // Ø¨Ù†Ùƒ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ù„Ù„Ø£Ø·ÙØ§Ù„
        const questionBank = [
            {
                emoji: "ğŸŒˆ",
                question: "ÙƒÙ… Ø¹Ø¯Ø¯ Ø£Ù„ÙˆØ§Ù† Ù‚ÙˆØ³ Ù‚Ø²Ø­ØŸ",
                options: ["5 Ø£Ù„ÙˆØ§Ù†", "7 Ø£Ù„ÙˆØ§Ù†", "10 Ø£Ù„ÙˆØ§Ù†", "3 Ø£Ù„ÙˆØ§Ù†"],
                correct: 1
            },
            {
                emoji: "ğŸ˜",
                question: "Ù…Ø§ Ù‡Ùˆ Ø£ÙƒØ¨Ø± Ø­ÙŠÙˆØ§Ù† Ø¨Ø±ÙŠØŸ",
                options: ["Ø§Ù„Ø£Ø³Ø¯", "Ø§Ù„Ø²Ø±Ø§ÙØ©", "Ø§Ù„ÙÙŠÙ„", "Ø§Ù„Ø¯Ø¨"],
                correct: 2
            },
            {
                emoji: "ğŸŒ",
                question: "Ø¹Ù„Ù‰ Ø£ÙŠ ÙƒÙˆÙƒØ¨ Ù†Ø¹ÙŠØ´ØŸ",
                options: ["Ø§Ù„Ù…Ø±ÙŠØ®", "Ø§Ù„Ø£Ø±Ø¶", "Ø§Ù„Ù…Ø´ØªØ±ÙŠ", "Ø²Ø­Ù„"],
                correct: 1
            },
            {
                emoji: "ğŸŒ™",
                question: "Ù…Ø§Ø°Ø§ Ù†Ø±Ù‰ ÙÙŠ Ø§Ù„Ø³Ù…Ø§Ø¡ Ù„ÙŠÙ„Ø§Ù‹ØŸ",
                options: ["Ø§Ù„Ø´Ù…Ø³", "Ø§Ù„Ù‚Ù…Ø± ÙˆØ§Ù„Ù†Ø¬ÙˆÙ…", "Ø§Ù„Ø³Ø­Ø¨ ÙÙ‚Ø·", "Ù‚ÙˆØ³ Ù‚Ø²Ø­"],
                correct: 1
            },
            {
                emoji: "ğŸ",
                question: "Ù…Ø§ Ù‡Ùˆ Ù„ÙˆÙ† Ø§Ù„ØªÙØ§Ø­Ø© Ø§Ù„Ù†Ø§Ø¶Ø¬Ø©ØŸ",
                options: ["Ø£Ø²Ø±Ù‚", "Ø£Ø­Ù…Ø± Ø£Ùˆ Ø£Ø®Ø¶Ø±", "Ø£ØµÙØ± ÙÙ‚Ø·", "Ø£Ø³ÙˆØ¯"],
                correct: 1
            },
            {
                emoji: "ğŸ±",
                question: "Ù…Ø§Ø°Ø§ ØªÙ‚ÙˆÙ„ Ø§Ù„Ù‚Ø·Ø©ØŸ",
                options: ["ÙˆØ§Ùˆ ÙˆØ§Ùˆ", "Ù…ÙˆØ§Ø¡ Ù…ÙˆØ§Ø¡", "ÙƒÙˆØ§Ùƒ ÙƒÙˆØ§Ùƒ", "Ø¹Ùˆ Ø¹Ùˆ"],
                correct: 1
            },
            {
                emoji: "ğŸ¨",
                question: "Ù…Ø§Ø°Ø§ ÙŠÙ†ØªØ¬ Ø®Ù„Ø· Ø§Ù„Ø£Ø­Ù…Ø± ÙˆØ§Ù„Ø£Ø²Ø±Ù‚ØŸ",
                options: ["Ø£Ø®Ø¶Ø±", "Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ", "Ø¨Ù†ÙØ³Ø¬ÙŠ", "Ø£ØµÙØ±"],
                correct: 2
            },
            {
                emoji: "â­",
                question: "ÙƒÙ… Ø¹Ø¯Ø¯ Ø£Ø¶Ù„Ø§Ø¹ Ø§Ù„Ù†Ø¬Ù…Ø©ØŸ",
                options: ["3", "4", "5", "6"],
                correct: 2
            },
            {
                emoji: "ğŸŒ³",
                question: "Ù…Ø§Ø°Ø§ ÙŠØ­ØªØ§Ø¬ Ø§Ù„Ù†Ø¨Ø§Øª Ù„ÙŠÙ†Ù…ÙˆØŸ",
                options: ["Ø§Ù„Ù…Ø§Ø¡ ÙˆØ§Ù„Ø´Ù…Ø³", "Ø§Ù„Ø´ÙˆÙƒÙˆÙ„Ø§ØªØ©", "Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨", "Ø§Ù„ØªÙ„ÙØ§Ø²"],
                correct: 0
            },
            {
                emoji: "ğŸ",
                question: "Ù…Ø§Ø°Ø§ ØªÙ†ØªØ¬ Ø§Ù„Ù†Ø­Ù„Ø©ØŸ",
                options: ["Ø§Ù„Ø­Ù„ÙŠØ¨", "Ø§Ù„Ø¹Ø³Ù„", "Ø§Ù„Ø¨ÙŠØ¶", "Ø§Ù„Ø¬Ø¨Ù†"],
                correct: 1
            },
            {
                emoji: "ğŸ¦",
                question: "Ù…Ø§ Ù‡Ùˆ Ù…Ù„Ùƒ Ø§Ù„ØºØ§Ø¨Ø©ØŸ",
                options: ["Ø§Ù„ÙÙŠÙ„", "Ø§Ù„Ø²Ø±Ø§ÙØ©", "Ø§Ù„Ø£Ø³Ø¯", "Ø§Ù„Ù‚Ø±Ø¯"],
                correct: 2
            },
            {
                emoji: "ğŸŒŠ",
                question: "Ù…Ø§ Ù‡Ùˆ Ù„ÙˆÙ† Ø§Ù„Ø¨Ø­Ø±ØŸ",
                options: ["Ø£Ø­Ù…Ø±", "Ø£Ø²Ø±Ù‚", "Ø£ØµÙØ±", "Ø£Ø®Ø¶Ø±"],
                correct: 1
            },
            {
                emoji: "â˜€ï¸",
                question: "Ù…ØªÙ‰ Ù†Ø±Ù‰ Ø§Ù„Ø´Ù…Ø³ØŸ",
                options: ["ÙÙŠ Ø§Ù„Ù„ÙŠÙ„", "ÙÙŠ Ø§Ù„Ù†Ù‡Ø§Ø±", "Ù„Ø§ Ù†Ø±Ø§Ù‡Ø§ Ø£Ø¨Ø¯Ø§Ù‹", "ÙÙŠ Ø§Ù„Ù…Ø³Ø§Ø¡ ÙÙ‚Ø·"],
                correct: 1
            },
            {
                emoji: "ğŸ•",
                question: "Ù…Ø§ Ù‡Ùˆ Ø´ÙƒÙ„ Ø§Ù„Ø¨ÙŠØªØ²Ø§ØŸ",
                options: ["Ù…Ø±Ø¨Ø¹", "Ù…Ø³ØªØ·ÙŠÙ„", "Ø¯Ø§Ø¦Ø±ÙŠ", "Ù…Ø«Ù„Ø«"],
                correct: 2
            },
            {
                emoji: "ğŸš—",
                question: "ÙƒÙ… Ø¹Ø¯Ø¯ Ø¹Ø¬Ù„Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø©ØŸ",
                options: ["2", "3", "4", "5"],
                correct: 2
            }
        ];

        // Ø¥Ø¶Ø§ÙØ© Ù„Ø§Ø¹Ø¨ Ø¬Ø¯ÙŠØ¯
        function addPlayer() {
            AudioEngine.click();

            if (playerCount >= MAX_PLAYERS) {
                showError('âš ï¸ Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ 4 Ù„Ø§Ø¹Ø¨ÙŠÙ†!');
                return;
            }

            const container = document.getElementById('playersContainer');
            const newGroup = document.createElement('div');
            newGroup.className = 'player-input-group';
            newGroup.innerHTML = `
                <span class="player-emoji-label">${playerEmojis[playerCount]}</span>
                <input type="text" class="player-input" placeholder="Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨ ${convertToArabicNumber(playerCount + 1)}" maxlength="20">
                <button class="remove-player-btn" onclick="removePlayer(this)">ğŸ—‘ï¸</button>
            `;
            container.appendChild(newGroup);
            playerCount++;

            hideError();

            if (playerCount >= MAX_PLAYERS) {
                document.getElementById('addPlayerBtn').style.display = 'none';
            }
        }

        // Ø¥Ø²Ø§Ù„Ø© Ù„Ø§Ø¹Ø¨
        function removePlayer(btn) {
            AudioEngine.click();

            if (playerCount <= MIN_PLAYERS) {
                showError('âš ï¸ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ù‡Ù†Ø§Ùƒ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ Ù„Ø§Ø¹Ø¨Ø§Ù†!');
                return;
            }

            btn.parentElement.remove();
            playerCount--;
            hideError();

            document.getElementById('addPlayerBtn').style.display = 'block';
        }

        // Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©
        function startCompetition() {
            AudioEngine.transition();

            const inputs = document.querySelectorAll('.player-input');
            players = [];

            inputs.forEach((input, index) => {
                const name = input.value.trim();

                if (!name) {
                    showError('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø£Ø³Ù…Ø§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†!');
                    input.focus();
                    return;
                }

                players.push({
                    id: index + 1,
                    name: name,
                    emoji: playerEmojis[index],
                    score: 0,
                    stage1Score: 0,
                    stage2Score: 0,
                    stage3Score: 0,
                    questionsAnswered: 0
                });
            });

            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            if (players.length < MIN_PLAYERS) {
                showError('âš ï¸ ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ Ù„Ø§Ø¹Ø¨ÙŠÙ†!');
                return;
            }

            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¹Ø¯Ù… ØªÙƒØ±Ø§Ø± Ø§Ù„Ø£Ø³Ù…Ø§Ø¡
            const names = players.map(p => p.name.toLowerCase());
            if (new Set(names).size !== names.length) {
                showError('âš ï¸ ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ù…Ø®ØªÙ„ÙØ©!');
                return;
            }

            // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ¨Ø¯Ø¡ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©
            localStorage.setItem('competitionPlayers', JSON.stringify(players));
            currentStage = 1;
            currentPlayerIndex = 0;
            currentQuestionIndex = 0;

            switchScreen('registrationScreen', 'quizScreen');
            loadQuestion();
        }

        // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø´Ø§Ø´Ø§Øª
        function switchScreen(fromId, toId) {
            document.getElementById(fromId).classList.remove('active');
            document.getElementById(toId).classList.add('active');
        }

        // ØªØ­Ù…ÙŠÙ„ Ø³Ø¤Ø§Ù„ Ø¬Ø¯ÙŠØ¯
        function loadQuestion() {
            const player = players[currentPlayerIndex];

            // ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„Ø­Ø§Ù„ÙŠ
            document.getElementById('currentPlayerEmoji').textContent = player.emoji;
            document.getElementById('currentPlayerName').textContent = player.name;
            document.getElementById('currentPlayerPoints').textContent = player.stage1Score;

            // Ø§Ø®ØªÙŠØ§Ø± Ø³Ø¤Ø§Ù„ Ø¹Ø´ÙˆØ§Ø¦ÙŠ
            const randomIndex = Math.floor(Math.random() * questionBank.length);
            const question = questionBank[randomIndex];

            // Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¤Ø§Ù„
            document.getElementById('questionEmoji').textContent = question.emoji;
            document.getElementById('questionText').textContent = question.question;
            document.getElementById('questionNum').textContent = player.questionsAnswered + 1;
            document.getElementById('totalQuestions').textContent = questionsPerPlayer;

            // Ø¹Ø±Ø¶ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';

            question.options.forEach((option, index) => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.textContent = option;
                btn.onclick = () => checkAnswer(index, question.correct);
                optionsContainer.appendChild(btn);
            });
        }

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©
        function checkAnswer(selected, correct) {
            const buttons = document.querySelectorAll('.option-btn');
            buttons.forEach(btn => btn.disabled = true);

            if (selected === correct) {
                AudioEngine.correct();
                buttons[selected].classList.add('correct');
                players[currentPlayerIndex].stage1Score += 10;
                players[currentPlayerIndex].score += 10;
                document.getElementById('currentPlayerPoints').textContent = players[currentPlayerIndex].stage1Score;
            } else {
                AudioEngine.wrong();
                buttons[selected].classList.add('wrong');
                buttons[correct].classList.add('correct');
            }

            players[currentPlayerIndex].questionsAnswered++;

            setTimeout(() => {
                if (players[currentPlayerIndex].questionsAnswered >= questionsPerPlayer) {
                    // Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø£Ù†Ù‡Ù‰ Ø£Ø³Ø¦Ù„ØªÙ‡ - Ø¹Ø±Ø¶ Ø´Ø§Ø´Ø© Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„
                    showTransitionScreen();
                } else {
                    // Ø³Ø¤Ø§Ù„ Ø¬Ø¯ÙŠØ¯ Ù„Ù†ÙØ³ Ø§Ù„Ù„Ø§Ø¹Ø¨
                    loadQuestion();
                }
            }, 1500);
        }

        // Ø¹Ø±Ø¶ Ø´Ø§Ø´Ø© Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„
        function showTransitionScreen() {
            const currentPlayer = players[currentPlayerIndex];

            document.getElementById('transitionEmoji').textContent = currentPlayer.emoji;
            document.getElementById('transitionMessage').textContent = `Ø§Ù†ØªÙ‡Ù‰ Ø¯ÙˆØ± ${currentPlayer.name}! ğŸ‰`;
            document.getElementById('transitionScore').textContent = `${currentPlayer.stage1Score} Ù†Ù‚Ø·Ø©`;

            currentPlayerIndex++;

            if (currentPlayerIndex >= players.length) {
                // Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø£Ù†Ù‡ÙˆØ§ Ø§Ù„Ù…Ø±Ø­Ù„Ø©
                document.getElementById('transitionNext').textContent = 'Ù„Ù†Ø±Ù‰ Ø§Ù„Ù†ØªØ§Ø¦Ø¬! ğŸ“Š';
            } else {
                const nextPlayer = players[currentPlayerIndex];
                document.getElementById('transitionNext').textContent = `Ø§Ù„Ø¢Ù† Ø¯ÙˆØ± ${nextPlayer.name} ${nextPlayer.emoji}`;
            }

            AudioEngine.transition();
            switchScreen('quizScreen', 'transitionScreen');
        }

        // Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„ØªØ§Ù„ÙŠ
        function continueToNextPlayer() {
            AudioEngine.click();

            if (currentPlayerIndex >= players.length) {
                // Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø§Ù†ØªÙ‡ÙˆØ§ - Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
                showScoreboard();
            } else {
                // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„ØªØ§Ù„ÙŠ
                switchScreen('transitionScreen', 'quizScreen');
                loadQuestion();
            }
        }

        // Ø¹Ø±Ø¶ Ù„ÙˆØ­Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬
        function showScoreboard() {
            const scoreboardList = document.getElementById('scoreboardList');
            scoreboardList.innerHTML = '';

            // ØªØ±ØªÙŠØ¨ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø­Ø³Ø¨ Ø§Ù„Ù†Ù‚Ø§Ø·
            const sortedPlayers = [...players].sort((a, b) => b.stage1Score - a.stage1Score);

            sortedPlayers.forEach((player, index) => {
                const item = document.createElement('div');
                item.className = 'player-score-item';
                item.innerHTML = `
                    <div class="player-info-left">
                        <span class="emoji">${player.emoji}</span>
                        <span class="name">${player.name}</span>
                    </div>
                    <span class="score">${player.stage1Score} Ù†Ù‚Ø·Ø©</span>
                `;
                scoreboardList.appendChild(item);
            });

            switchScreen('transitionScreen', 'scoreboardScreen');
        }

        // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©
        function goToStage2() {
            AudioEngine.transition();

            // Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†
            localStorage.setItem('competitionPlayers', JSON.stringify(players));
            localStorage.setItem('currentStage', '2');

            // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©
            window.location.href = 'competition-stage2.html';
        }

        // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø®Ø·Ø£
        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.textContent = message;
            errorDiv.classList.add('show');
        }

        // Ø¥Ø®ÙØ§Ø¡ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£
        function hideError() {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.classList.remove('show');
        }

        // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø¥Ù„Ù‰ Ø¹Ø±Ø¨ÙŠØ©
        function convertToArabicNumber(num) {
            const arabicNumbers = ['Ø§Ù„Ø£ÙˆÙ„', 'Ø§Ù„Ø«Ø§Ù†ÙŠ', 'Ø§Ù„Ø«Ø§Ù„Ø«', 'Ø§Ù„Ø±Ø§Ø¨Ø¹'];
            return arabicNumbers[num - 1] || num;
        }
    </script>
</body>

</html>